"""
ARC Platform - AI Orchestration Entry Point
A modular, domain-agnostic AI system for processing diverse tasks.
"""

from utils.ai_client import ask_ai, is_model_ready
from utils.conversation_manager import ConversationManager
from utils.formatter import format_user_input
import sys

# ============================================================================
# WELCOME SCREEN
# ============================================================================

def print_welcome():
    """Show welcome message."""
    print("\n" + "="*60)
    print("ü§ñ  ARC Platform - AI Orchestration System")
    print("="*60)
    print("\nWelcome! This is a flexible AI system ready to assist.")
    print("\nCapabilities:")
    print("  üí¨ Natural language processing")
    print("  üß† Reasoning and analysis")
    print("  üíª Code generation and review")
    print("  ‚ú® Creative content generation")
    print("\nCommands: /help /reset /quit")
    print("="*60 + "\n")

def print_help():
    """Show help information."""
    print("\n" + "‚îÄ"*60)
    print("üìñ HELP - System Usage")
    print("‚îÄ"*60)
    print("\nü§ñ SYSTEM CAPABILITIES:")
    print("  ‚Ä¢ Process natural language queries")
    print("  ‚Ä¢ Generate responses based on context")
    print("  ‚Ä¢ Maintain conversation history")
    print("  ‚Ä¢ Support various task types")
    print("\nüí¨ EXAMPLE QUERIES:")
    print("  ‚Ä¢ 'Explain quantum computing'")
    print("  ‚Ä¢ 'Write a Python function for sorting'")
    print("  ‚Ä¢ 'Summarize this text'")
    print("  ‚Ä¢ 'Generate creative content'")
    print("\n‚ö†Ô∏è  NOTE: This is an AI system with general capabilities.")
    print("   Responses are generated by AI models and should be verified.")
    print("\n‚å®Ô∏è  COMMANDS:")
    print("  /help  - Show this help")
    print("  /reset - Clear conversation history")
    print("  /quit  - Exit the application")
    print("‚îÄ"*60 + "\n")

# ============================================================================
# MAIN APPLICATION
# ============================================================================

def main():
    """Main application loop."""
    
    # Show welcome
    print_welcome()
    
    # Check model readiness
    if not is_model_ready():
        print("‚ùå Model initialization failed. Please restart.\n")
        sys.exit(1)
    
    # Initialize conversation manager
    convo = ConversationManager()
    print("System ready. Enter your query:\n")
    
    while True:
        try:
            # Get user input
            user_input = input("User: ").strip()
            
            # Skip empty input
            if not user_input:
                continue
            
            # Handle exit commands
            if user_input.lower() in ['/quit', 'quit', 'exit']:
                print("\nShutting down. Thank you for using ARC Platform.\n")
                break
            
            # Handle help command
            if user_input.lower() == '/help':
                print_help()
                continue
            
            # Handle reset command
            if user_input.lower() == '/reset':
                convo.reset()
                print("üîÑ Conversation history cleared.\n")
                continue
            
            # Format input for processing
            formatted = format_user_input(user_input)
            
            # Process query with AI
            print("‚öôÔ∏è  Processing...", end='', flush=True)
            
            try:
                response = ask_ai(formatted, convo.get_history())
            except Exception as e:
                print(f"\r‚ùå Error: {e}")
                print("Request failed. Please try again.\n")
                continue
            
            # Clear processing indicator
            print("\r" + " "*20 + "\r", end='')
            
            # Update conversation history
            convo.add_message("user", formatted)
            convo.add_message("assistant", response)
            
            # Display response
            print(f"AI: {response}\n")
        
        except KeyboardInterrupt:
            print("\n\nApplication terminated by user.\n")
            break
        
        except Exception as e:
            print(f"\n‚ùå Error: {e}\n")
            continue

# ============================================================================
# ENTRY POINT
# ============================================================================

if __name__ == "__main__":
    try:
        main()
    except Exception as e:
        print(f"\n‚ùå Fatal error: {e}")
        print("Application will now exit.\n")
        sys.exit(1)
